import { ExploitCVE20195786Request, ExploitCVE20195786Response } from '../../shared/vulnerability/CVE20195786';
import puppeteer from 'puppeteer';

export const exploitCVE20195786 = async (
  args: ExploitCVE20195786Request,
  context: any,
): Promise<ExploitCVE20195786Response> => {
  console.log('puppeteer launch');
  const browser = await puppeteer.launch({
    headless: true,
    // --single-process was causing puppeteer some startup problems, these options are not related to the vulnerability
    args: [
        '--disable-gpu',
        '--disable-dev-shm-usage',
        '--disable-setuid-sandbox',
        '--no-first-run',
        '--no-sandbox',
        '--no-zygote',
        '--deterministic-fetch',
        '--disable-features=IsolateOrigins',
        '--disable-site-isolation-trials',
        // '--single-process',
    ],
  });

  console.log('puppeteer new page');
  const page = await browser.newPage();

  console.log('opening website', args.url)
  await page.goto(args.url);
  const title = await page.title();

  console.log(`page title: "${title}"`);

  await browser.close();
  return {
    title: title
  }
}
